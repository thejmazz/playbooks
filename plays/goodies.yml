---
- hosts: all

  become: yes
  become_user: root
  become_method: sudo

  tasks:
    - apt_repository: "repo=ppa:neovim-ppa/stable"
    - apt: "update_cache=yes"
    - apt: name={{ item }}
      with_items:
        - software-properties-common # for apt-add-repository
        - curl
        - htop
        - python-dev
        - python-pip
        - python3-dev
        - python3-pip
        - neovim
    - pip: "name=neovim executable=pip3"
    - get_url:
        url: https://github.com/TheLocehiliosan/yadm/raw/master/yadm
        dest: /usr/local/bin/yadm
        mode: a+x

    - apt: "name=language-pack-en"
    - locale_gen:
        name: en_CA.UTF-8

    # tmux
    - apt: name={{ item }}
      with_items:
        - libevent-dev
        - libncurses-dev
    - get_url:
        url: "https://github.com/tmux/tmux/releases/download/{{ tmux_version }}/tmux-{{ tmux_version }}.tar.gz"
        dest: /usr/local/src
      register: tmux_download
      vars:
        tmux_version: 2.5
    - unarchive:
        src: "{{ tmux_download.dest }}"
        dest: /usr/local/src
        remote_src: yes
      register: tmux_unarchive
    - shell: "./configure && make && make install"
      args:
        chdir: "/usr/local/src/tmux-2.5"

  roles:
    - role: angstwad.docker_ubuntu
      apt_key_url: https://download.docker.com/linux/ubuntu/gpg
      apt_key_sig: 9DC858229FC7DD38854AE2D88D81803C0EBFCD88
      apt_repository: deb [arch=amd64] https://download.docker.com/linux/ubuntu {{ ansible_lsb.codename|lower }} stable
      docker_pkg_name: docker-ce=17.06.0*
      docker_opts: "--bip 10.100.0.1/24"
      pip_version_docker_compose: 1.14.0
      docker_group_members: [ 'julian' ]
